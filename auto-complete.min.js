/*!component-auto-complete v1.0.0 | NHN Entertainment*/
!function(){ne.util.defineNamespace("ne.component"),ne.component.AutoComplete=ne.util.defineClass({flowMap:{NEXT:"next",PREV:"prev",FIRST:"first",LAST:"last"},watchInterval:200,init:function(a){if(this.options={},this._checkValidation(a)){var b,c=ne.component.AutoComplete,d="_atcp_use_cookie";this.options.toggleImg&&this.options.onoffTextElement?(b=$.cookie(this.options.cookieName),this.isUse=!("use"!==b&&b)):(this.isUse=!0,delete this.options.onoffTextElement),this.options.cookieName||(this.options.cookieName=d),this.options.watchInterval=ne.util.isExisty(this.options.watchInterval)?this.options.watchInterval:this.watchInterval,this.dataManager=new c.DataManager(this,this.options),this.inputManager=new c.InputManager(this,this.options),this.resultManager=new c.ResultManager(this,this.options),this.querys=null,this.isIdle=!0,this.setToggleBtnImg(this.isUse),this.setCookieValue(this.isUse)}},_checkValidation:function(a){var b,c;if(b=a.config,!ne.util.isExisty(b))throw new Error("Config file is not avaliable. #"+b);c=ne.util.keys(b);var d,e=c.length,f=["resultListElement","searchBoxElement","orgQueryElement","subQuerySet","template","listConfig","actions","formElement","searchUrl","searchApi"],g=[];for(d=0;e>d;d++)ne.util.inArray(c[d],f,0)>=0&&g.push(c[d]);for(ne.util.forEach(f,function(a){if(-1===ne.util.inArray(a,g,0))throw new Error(a+"does not not exist.");return"searchApi"!==a||!b.searchApi||b.searchUrl&&b.searchApi.st&&b.searchApi.r_lt?void 0:(alert("searchApi required value does not exist."),!1)}),d=0;e>d;d++){var h=c[d],i=b[h];"string"!=typeof i||"."!==i.charAt(0)&&"#"!==i.charAt(0)?this.options[h]=b[h]:this.options[h]=$(i)}return!0},request:function(a){this.dataManager.request(a)},getValue:function(){return this.inputManager.getValue()},setValue:function(a){this.inputManager.setValue(a)},setParams:function(a,b){this.inputManager.setParams(a,b)},setServerData:function(a){this.resultManager.draw(a)},setCookieValue:function(a){$.cookie(this.options.cookieName,a?"use":"notUse"),this.isUse=a,this.setToggleBtnImg(a)},setQuerys:function(a){this.querys=[].concat(a)},isUseAutoComplete:function(){return this.isUse},isShowResultList:function(){return this.resultManager.isShowResultList()},setToggleBtnImg:function(a){this.inputManager.setToggleBtnImg(a)},hideResultList:function(){this.isUseAutoComplete()&&this.resultManager.hideResultList()},showResultList:function(){this.isUseAutoComplete()&&this.resultManager.showResultList()},moveNextList:function(a){this.resultManager.moveNextList(a)},changeOnOffText:function(a){this.resultManager.changeOnOffText(a)},getMoved:function(){return this.resultManager.isMoved},setMoved:function(a){this.resultManager.isMoved=a},setSearchApi:function(a){ne.util.extend(this.options.searchApi,a)},clearReadyValue:function(){ne.util.isExisty(this.readyValue)?this.request(this.readyValue):this.isIdle=!0,this.readyValue=null}}),ne.util.CustomEvents.mixin(ne.component.AutoComplete),ne.component.AutoComplete.DataManager=ne.util.defineClass({init:function(a,b){return 2!=arguments.length?void alert("argument length error !"):(this.autoCompleteObj=a,void(this.options=b))},request:function(a){var b=a.replace(/\s/g,"");if(!a||!b)return void this.autoCompleteObj.hideResultList();var c,d={q:a,r_enc:"UTF-8",q_enc:"UTF-8",r_format:"json",_callback:"dataCallback"},e=ne.util.extend(this.options.searchApi,d);$.ajax.request(this.options.searchUrl,{dataType:"jsonp",jsonpCallback:"dataCallback",data:e,type:"get",success:ne.util.bind(function(a){try{c=this._getCollectionData(a),this.autoCompleteObj.setQuerys(a.query),this.autoCompleteObj.setServerData(c),this.autoCompleteObj.clearReadyValue()}catch(b){throw new Error("[DataManager] Request faild.",b)}},this)})},_getCollectionData:function(a){var b=a.collections,c=[];return ne.util.forEach(b,function(a){if(!ne.util.isEmpty(a.items)){var b=this._getRedirectData(a);c.push({type:"title",values:[a.title]}),c=c.concat(b)}},this),c},_getRedirectData:function(a){var b=a.type,c=a.index,d=a.destination,e=[];return ne.util.forEachArray(a.items,function(a,f){f<=this.options.viewCount-1&&e.push({values:a,type:b,index:c,dest:d})},this),e}}),ne.component.AutoComplete.InputManager=ne.util.defineClass({keyCodeMap:{TAB:9,UP_ARROW:38,DOWN_ARROW:40},init:function(a,b){return 2!=arguments.length?void alert("argument length error !"):(this.autoCompleteObj=a,this.options=b,this.$searchBox=this.options.searchBoxElement,this.$toggleBtn=this.options.toggleBtnElement,this.$orgQuery=this.options.orgQueryElement,this.$formElement=this.options.formElement,this.inputValue=this.$searchBox.val(),void this._attachEvent())},getValue:function(){return this.$searchBox.val()},setValue:function(a){this.inputValue=a,this.$searchBox.val(a)},setParams:function(a,b){var c=this.options,d=c.listConfig[b],e=c.staticParams[d.staticParams];a&&ne.util.isString(a)&&(a=a.split(",")),(a&&!ne.util.isEmpty(a)||ne.util.isExisty(e))&&this._createParamSetByType(a,b)},_createParamSetByType:function(a,b){var c,d=this.options,e=d.listConfig[b],f=d.subQuerySet[e.subQuerySet],g=d.staticParams[e.staticParams];this.hiddens||this._createParamContainer(),ne.util.forEach(a,function(a,b){c=f[b],this.hiddens.append($('<input type="hidden" name="'+c+'" value="'+a+'" />'))},this),g&&this._createStaticParams(g)},_createStaticParams:function(a){a=a.split(","),ne.util.forEach(a,function(a){val=a.split("="),this.hiddens.append($('<input type="hidden" name="'+val[0]+'" value="'+val[1]+'" />'))},this)},_createParamContainer:function(){this.hiddens=$('<div class="hidden-inputs"></div>'),this.hiddens.hide(),this.hiddens.appendTo($(this.$formElement))},setToggleBtnImg:function(a){this.options.toggleImg&&this.$toggleBtn&&(a?this.$toggleBtn.attr("src",this.options.toggleImg.on):this.$toggleBtn.attr("src",this.options.toggleImg.off))},_attachEvent:function(){this.$searchBox.bind("focus keyup keydown blur click",$.proxy(function(a){switch(a.type){case"focus":this._onFocus();break;case"blur":this._onBlur(a);break;case"keyup":this._onKeyUp(a);break;case"keydown":this._onKeyDown(a);break;case"click":this._onClick()}},this)),this.$toggleBtn&&this.$toggleBtn.bind("click",$.proxy(function(a){this._onClickToggle()},this))},_setOrgQuery:function(a){this.$orgQuery.val(a)},_onClick:function(){return this.autoCompleteObj.getValue()&&this.autoCompleteObj.isUseAutoComplete()?void(this.autoCompleteObj.isShowResultList()?this.autoCompleteObj.hideResultList():this.autoCompleteObj.showResultList()):!1},_onFocus:function(){this.intervalId=setInterval($.proxy(function(){this._onWatch()},this),this.options.watchInterval)},_onWatch:function(){""===this.$searchBox.val()&&(this._setOrgQuery(""),this.autoCompleteObj.setMoved(!1)),this.inputValue!==this.$searchBox.val()?(this.inputValue=this.$searchBox.val(),this._onChange()):this.autoCompleteObj.getMoved()||this._setOrgQuery(this.$searchBox.val())},_onKeyUp:function(){this.inputValue!==this.$searchBox.val()&&(this.inputValue=this.$searchBox.val(),this._onChange())},_onChange:function(){this.autoCompleteObj.isUseAutoComplete()&&(this.autoCompleteObj.isIdle?(this.autoCompleteObj.isIdle=!1,this.autoCompleteObj.request(this.$searchBox.val())):this.autoCompleteObj.readyValue=this.$searchBox.val())},_onBlur:function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},_onKeyDown:function(a){var b=this.autoCompleteObj;if(b.isUseAutoComplete()&&b.isShowResultList()){var c=a.keyCode,d=null,e=this.keyCodeMap,f=b.flowMap;if(c===e.TAB)a.preventDefault(),d=a.shiftKey?f.NEXT:f.PREV;else if(c===e.DOWN_ARROW)d=f.NEXT;else{if(c!==e.UP_ARROW)return;d=f.PREV}b.moveNextList(d)}},_onClickToggle:function(){this.autoCompleteObj.isUseAutoComplete()?(this.autoCompleteObj.hideResultList(),this.setToggleBtnImg(!1),this.autoCompleteObj.setCookieValue(!1),this.autoCompleteObj.changeOnOffText(!0)):(this.setToggleBtnImg(!0),this.autoCompleteObj.setCookieValue(!0),this.autoCompleteObj.changeOnOffText(!1))}}),ne.component.AutoComplete.ResultManager=ne.util.defineClass({init:function(a,b){this.autoCompleteObj=a,this.options=b,this.$resultList=this.options.resultListElement,this.resultSelector=this.options.resultListElement,this.viewCount=this.options.viewCount||10,this.$onOffTxt=this.options.onoffTextElement,this.mouseOverClass=this.options.mouseOverClass,this.flowMap=this.autoCompleteObj.flowMap,this._attachEvent(),this.selectedElement=null,this.isMoved=!1},_deleteBeforeElement:function(){this.$resultList.html(""),this.$resultList.hide(),this.selectedElement=null},draw:function(a){this._deleteBeforeElement();var b=a.length;1>b?this._hideBottomArea():this._makeResultList(a,b),this.$resultList.show(),this._showBottomArea()},_makeResultList:function(a,b){var c,d,e,f,g,h,i=this.options.template,j=this.options.listConfig,k=this.options.useTitle&&!!i.title;for(h=0;b>h;h++)e=a[h].type,d=a[h].index,c=j[d]?i[j[d].template]:i.defaults,("title"!==e||(c=i.title,k))&&(f=this._getTmplData(c.attr,a[h]),g=$(this._applyTemplate(c.element,f)),g.attr("data-params",f.params),g.attr("data-index",d),this.$resultList.append(g))},_getTmplData:function(a,b){var c={},d=b.values||null;return ne.util.isString(b)?(c[a[0]]=b,c):(ne.util.forEach(a,function(a,b){c[a]=d[b]}),a.length<d.length&&(c.params=d.slice(a.length)),c)},isShowResultList:function(){return"block"===this.$resultList.css("display")},hideResultList:function(){this.$resultList.css("display","none"),this._hideBottomArea(),this.autoCompleteObj.isIdle=!0,this.autoCompleteObj.fire("close")},showResultList:function(){var a=this;setTimeout(function(){a.$resultList.css("display","block")},0),this._showBottomArea()},moveNextList:function(a){var b,c=this.flowMap,d=this.selectedElement,e=a===c.NEXT?this._getNext:this._getPrev,f=a===c.NEXT?this._getFirst:this._getLast;this.isMoved=!0,d?(d.removeClass(this.mouseOverClass),d=this.selectedElement=e.call(this,d)):d=this.selectedElement=f.call(this),b=d.find(".keyword-field").text(),d&&b?(d.addClass(this.mouseOverClass),this.autoCompleteObj.setValue(b),this._setSubmitOption()):d&&this.moveNextList(a)},changeOnOffText:function(a){a?(this.$onOffTxt.text("자동완성 켜기"),this.hideResultList()):this.$onOffTxt.text("자동완성 끄기")},_attachEvent:function(){this.$resultList.bind("mouseover click",$.proxy(function(a){"mouseover"===a.type?this._onMouseOver(a):"click"===a.type&&this._onClick(a)},this)),this.$onOffTxt&&this.$onOffTxt.bind("click",$.proxy(function(){this._useAutoComplete()},this)),$(document).bind("click",$.proxy(function(a){"html"===a.target.tagName.toLowerCase()&&this.hideResultList()},this))},_applyTemplate:function(a,b){var c,d={};for(c in b)d[c]=b[c],"subject"===c&&(d.subject=this._highlight(b.subject)),b.propertyIsEnumerable(c)&&(a=a.replace(new RegExp("@"+c+"@","g"),d[c]));return a},_highlight:function(a){var b,c=this.autoCompleteObj.querys;return ne.util.forEach(c,function(c){b||(b=a),b=this._makeStrong(b,c)},this),b||a},_makeStrong:function(a,b){if(!b||b.length<1)return a;var c,d,e,f=new RegExp("[.*+?|()\\[\\]{}\\\\]","g"),g=b.replace(/()/g," ").replace(/^\s+|\s+$/g,""),h=g.match(/\S/g),i=h.length,j=[],k="";for(e=0,d=i;d>e;e++)j.push(h[e].replace(/[\S]+/g,"["+h[e].toLowerCase().replace(f,"\\$&")+"|"+h[e].toUpperCase().replace(f,"\\$&")+"] ").replace(/[\s]+/g,"[\\s]*"));return g="("+j.join("")+")",c=new RegExp(g),c.test(a)&&(k=a.replace(c,"<strong>"+RegExp.$1+"</strong>")),k},_getFirst:function(){return this._orderStage(this.flowMap.FIRST)},_getLast:function(){return this._orderStage(this.flowMap.LAST)},_orderStage:function(a){return a=a===this.flowMap.FIRST?"first":"last",this.$resultList&&this.$resultList.children()&&this.$resultList.children().length?this.$resultList.children()[a]():null},_getNext:function(a){return this._orderElement(this.flowMap.NEXT,a)},_getPrev:function(a){return this._orderElement(this.flowMap.PREV,a)},_orderElement:function(a,b){if(!ne.util.isExisty(b))return null;var c,d=$(b),e=a===this.flowMap.NEXT;return d.closest(this.resultSelector)?(c=e?b.next():b.prev(),c.length?c:e?this._getFirst():this._getLast()):void 0},_useAutoComplete:function(){var a=this.autoCompleteObj.isUseAutoComplete();this.changeOnOffText(a),this.autoCompleteObj.setCookieValue(!a)},_showBottomArea:function(){this.$onOffTxt&&this.$onOffTxt.show()},_hideBottomArea:function(){this.$onOffTxt&&this.$onOffTxt.hide()},_setSubmitOption:function(a){this._clearSubmitOption();var b,c=this.options.formElement,d=a?$(a).closest("li"):$(this.selectedElement),e=this.options.actions,f=d.attr("data-index"),g=this.options.listConfig[f],h=e[g.action];$(c).attr("action",h),b=d.attr("data-params"),this.autoCompleteObj.setParams(b,f),this.autoCompleteObj.fire("change",{index:f,action:h,params:b})},_clearSubmitOption:function(a){var b=this.options.formElement,c=$(b).find(".hidden-inputs");c.html("")},_onMouseOver:function(a){var b=$(a.target),c=this.$resultList.find("li"),d=b.closest("li");ne.util.forEachArray(c,function(a){$(a).removeClass(this.mouseOverClass)},this),d&&d.find(".keyword-field").length&&d.addClass(this.mouseOverClass),this.selectedElement=b},_onClick:function(a){var b=$(a.target),c=this.options.formElement,d=b.closest("li"),e=d.find(".keyword-field"),f=e.text();this.autoCompleteObj.setValue(f),c&&f&&(this._setSubmitOption(b),c.submit())}})}();
//# sourceMappingURL=auto-complete.min.map