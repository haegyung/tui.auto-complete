/*!Component-AutoComplete v1.0.0 | NHN Entertainment*/
!function(){ne=window.ne||{},ne.component=ne.component||{},ne.component.AutoComplete=ne.util.defineClass({flowMap:{NEXT:"next",PREV:"prev",FIRST:"first",LAST:"last"},watchInterval:200,init:function(a){this.options={};var b,c=ne.component.AutoComplete,d="_atcp_use_cookie";this._checkValidation(a)&&(this.options.toggleImg&&this.options.onoffTextElement?(b=$.cookie(this.options.cookieName),this.isUse=!("use"!==b&&b)):(this.isUse=!0,delete this.options.onoffTextElement),this.options.cookieName||(this.options.cookieName=d),this.options.watchInterval=ne.util.isExisty(this.options.watchInterval)?this.options.watchInterval:this.watchInterval,this.dataManager=new c.DataManager(this,this.options),this.inputManager=new c.InputManager(this,this.options),this.resultManager=new c.ResultManager(this,this.options),this.querys=null,this.isIdle=!0,this.setToggleBtnImg(this.isUse),this.setCookieValue(this.isUse))},_checkValidation:function(a){var b,c;if(b=a.config,!ne.util.isExisty(b))return alert("유효한 config가 아닙니다 : "+b),!1;c=ne.util.keys(b);var d,e=c.length,f=["resultListElement","searchBoxElement","orgQueryElement","subQuerySet","template","listConfig","actions","formElement","searchUrl","searchApi"],g=[];for(d=0;e>d;d++)ne.util.inArray(c[d],f,0)>=0&&g.push(c[d]);for(ne.util.forEach(f,function(a){return-1===ne.util.inArray(a,g,0)?(alert("설정값이 없습니다 : "+a),!1):"searchApi"!==a||!b.searchApi||b.searchUrl&&b.searchApi.st&&b.searchApi.r_lt?void 0:(alert("searchApi항목의 필수값이 없습니다."),!1)}),d=0;e>d;d++){var h=c[d],i=b[h];this.options[h]="string"!=typeof i||"."!==i.charAt(0)&&"#"!==i.charAt(0)?b[h]:$(i)}return!0},request:function(a){this.dataManager.request(a)},getValue:function(){return this.inputManager.getValue()},setValue:function(a){this.inputManager.setValue(a)},setParams:function(a,b){this.inputManager.setParams(a,b)},setServerData:function(a){this.resultManager.draw(a)},setCookieValue:function(a){$.cookie(this.options.cookieName,a?"use":"notUse"),this.isUse=a,this.setToggleBtnImg(a)},setQuerys:function(a){this.querys=[].concat(a)},isUseAutoComplete:function(){return this.isUse},isShowResultList:function(){return this.resultManager.isShowResultList()},setToggleBtnImg:function(a){this.inputManager.setToggleBtnImg(a)},hideResultList:function(){this.isUseAutoComplete()&&this.resultManager.hideResultList()},showResultList:function(){this.isUseAutoComplete()&&this.resultManager.showResultList()},moveNextList:function(a){this.resultManager.moveNextList(a)},changeOnOffText:function(a){this.resultManager.changeOnOffText(a)},isVisibleResult:function(){return this.resultManager.isShowResultList()},getMoved:function(){return this.resultManager.isMoved},setMoved:function(a){this.resultManager.isMoved=a},setSearchApi:function(a){ne.util.extend(this.options.searchApi,a)}}),ne.util.CustomEvents.mixin(ne.component.AutoComplete),ne=window.ne||{},ne.component=ne.component||{},ne.component.AutoComplete.DataManager=ne.util.defineClass({init:function(a,b){return 2!=arguments.length?void alert("argument length error !"):(this.autoCompleteObj=a,void(this.options=b))},request:function(a){if(this.options.searchApi){var b=a.replace(/\s/g,"");if(!a||!b)return void this.autoCompleteObj.hideResultList();var c,d={q:a,r_enc:"UTF-8",q_enc:"UTF-8",r_format:"json",_callback:"dataCallback"},e=ne.util.extend(this.options.searchApi,d);ne.util.ajax.request(this.options.searchUrl,{dataType:"jsonp",jsonpCallback:"dataCallback",data:e,type:"get",success:ne.util.bind(function(a){try{c=this._getCollectionData(a),this.autoCompleteObj.setQuerys(a.query),this.autoCompleteObj.setServerData(c),this.clearReadyValue()}catch(b){throw new Error("[DataManager] 서버에서 정보를 받을 수 없습니다. ",b)}},this)})}},clearReadyValue:function(){ne.util.isExisty(this.autoCompleteObj.readyValue)?this.autoCompleteObj.request(this.autoCompleteObj.readyValue):this.autoCompleteObj.isIdle=!0,this.autoCompleteObj.readyValue=null},_getCollectionData:function(a){var b=a.collections,c=[];return ne.util.forEach(b,function(a){if(!ne.util.isEmpty(a.items)){var b=this._getRedirectData(a);c.push({type:"title",values:[a.title]}),c=c.concat(b)}},this),c},_getRedirectData:function(a){var b=a.type,c=a.index,d=a.destination,e=[];return ne.util.forEachArray(a.items,function(a,f){f<=this.options.viewCount-1&&e.push({values:a,type:b,index:c,dest:d})},this),e}}),ne=window.ne||{},ne.component=ne.component||{},ne.component.AutoComplete.InputManager=ne.util.defineClass({keyCodeMap:{TAB:9,UP_ARROW:38,DOWN_ARROW:40},init:function(a,b){return 2!=arguments.length?void alert("argument length error !"):(this.autoCompleteObj=a,this.options=b,this.$searchBox=this.options.searchBoxElement,this.$toggleBtn=this.options.toggleBtnElement,this.$orgQuery=this.options.orgQueryElement,this.$formElement=this.options.formElement,this.inputValue=this.$searchBox.val(),void this._attachEvent())},getValue:function(){return this.$searchBox.val()},setValue:function(a){this.inputValue=a,this.$searchBox.val(a)},setParams:function(a,b){var c=this.options,d=c.listConfig[b],e=c.staticParams[d.staticParams];a&&ne.util.isString(a)&&(a=a.split(",")),(a&&!ne.util.isEmpty(a)||ne.util.isExisty(e))&&this._createParamSetByType(a,b)},_createParamSetByType:function(a,b){var c,d,e=this.options,f=e.listConfig[b],g=e.subQuerySet[f.subQuerySet],h=e.staticParams[f.staticParams];this.hiddens||this._createParamContainer(),ne.util.forEach(a,function(a,b){c=g[b],this.hiddens.append($('<input type="hidden" name="'+c+'" value="'+a+'" />'))},this),h&&(h=h.split(","),ne.util.forEach(h,function(a){d=a.split("="),this.hiddens.append($('<input type="hidden" name="'+d[0]+'" value="'+d[1]+'" />'))},this))},_createParamContainer:function(){this.hiddens=$('<div class="hidden-inputs"></div>'),this.hiddens.hide(),this.hiddens.appendTo($(this.$formElement))},setToggleBtnImg:function(a){this.options.toggleImg&&this.$toggleBtn&&(a?this.$toggleBtn.attr("src",this.options.toggleImg.on):this.$toggleBtn.attr("src",this.options.toggleImg.off))},_attachEvent:function(){this.$searchBox.bind("focus keyup keydown blur click",$.proxy(function(a){switch(a.type){case"focus":this._onFocus();break;case"blur":this._onBlur(a);break;case"keyup":this._onKeyUp(a);break;case"keydown":this._onKeyDown(a);break;case"click":this._onClick()}},this)),this.$toggleBtn&&this.$toggleBtn.bind("click",$.proxy(function(){this._onClickToggle()},this))},_setOrgQuery:function(a){this.$orgQuery.val(a)},_onClick:function(){return this.autoCompleteObj.getValue()&&this.autoCompleteObj.isUseAutoComplete()?void(this.autoCompleteObj.isShowResultList()?this.autoCompleteObj.hideResultList():this.autoCompleteObj.showResultList()):!1},_onFocus:function(){var a=this;this.intervalId=setInterval($.proxy(function(){a._onWatch()}),this,10)},_onWatch:function(){""===this.$searchBox.val()&&(this._setOrgQuery(""),this.autoCompleteObj.setMoved(!1)),this.inputValue!==this.$searchBox.val()?(this.inputValue=this.$searchBox.val(),this._onChange()):this.autoCompleteObj.getMoved()||this._setOrgQuery(this.$searchBox.val())},_onKeyUp:function(){this.inputValue!==this.$searchBox.val()&&(this.inputValue=this.$searchBox.val(),this._onChange())},_onChange:function(){this.autoCompleteObj.isUseAutoComplete()&&(this.autoCompleteObj.isIdle?(this.autoCompleteObj.isIdle=!1,this.autoCompleteObj.request(this.$searchBox.val())):this.autoCompleteObj.readyValue=this.$searchBox.val())},_onBlur:function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},_onKeyDown:function(a){var b=this.autoCompleteObj;if(b.isUseAutoComplete()&&b.isVisibleResult()){var c=a.keyCode,d=null,e=this.keyCodeMap,f=b.flowMap;if(c===e.TAB)a.preventDefault(),d=a.shiftKey?f.NEXT:f.PREV;else if(c===e.DOWN_ARROW)d=f.NEXT;else{if(c!==e.UP_ARROW)return;d=f.PREV}b.moveNextList(d)}},_onClickToggle:function(){this.autoCompleteObj.isUseAutoComplete()?(this.autoCompleteObj.hideResultList(),this.setToggleBtnImg(!1),this.autoCompleteObj.setCookieValue(!1),this.autoCompleteObj.changeOnOffText(!0)):(this.setToggleBtnImg(!0),this.autoCompleteObj.setCookieValue(!0),this.autoCompleteObj.changeOnOffText(!1))}}),ne=window.ne||{},ne.component=ne.component||{},ne.component.AutoComplete.ResultManager=ne.util.defineClass({init:function(a,b){this.autoCompleteObj=a,this.options=b,this.$resultList=this.options.resultListElement,this.resultSelector=this.options.resultListElement,this.viewCount=this.options.viewCount||10,this.$onOffTxt=this.options.onoffTextElement,this.mouseOverClass=this.options.mouseOverClass,this.flowMap=this.autoCompleteObj.flowMap,this._attachEvent(),this.selectedElement=null,this.isMoved=!1},draw:function(a){this.$resultList.html(""),this.$resultList.hide(),this.selectedElement=null;var b,c,d,e,f,g,h=this.options.template,i=this.options.listConfig,j=this.options.useTitle&&!!h.title,k=a.length,l=k;for(1>k&&this._hideBottomArea(),g=0;l>g;g++)d=a[g].type,c=a[g].index,b=i[c]?h[i[c].template]:h.defaults,"title"===d&&(b=h.title,f&&f.addClass("lastitem")),(j||"title"!==d)&&(e=this._getTmplData(b.attr,a[g]),f=$(this._applyTemplate(b.element,e)),f.attr("data-params",e.params),f.attr("data-index",c),this.$resultList.append(f));this.$resultList.show(),this._showBottomArea()},_getTmplData:function(a,b){var c={},d=b.values||null;return ne.util.isString(b)?(c[a[0]]=b,c):(ne.util.forEach(a,function(a,b){c[a]=d[b]}),a.length<d.length&&(c.params=d.slice(a.length)),c)},isShowResultList:function(){return"block"===this.$resultList.css("display")},hideResultList:function(){this.$resultList.css("display","none"),this._hideBottomArea(),this.autoCompleteObj.isIdle=!0,this.autoCompleteObj.fire("close")},showResultList:function(){var a=this;setTimeout(function(){a.$resultList.css("display","block")},0),this._showBottomArea()},moveNextList:function(a){var b=this.flowMap,c=this.selectedElement,d=a===b.NEXT?this._getNext:this._getPrev,e=a===b.NEXT?this._getFirst:this._getLast;this.isMoved=!0,c?(c.removeClass(this.mouseOverClass),c=this.selectedElement=d.call(this,c)):c=this.selectedElement=e.call(this);var f=c.find(".keyword-field").text();c&&f?(c.addClass(this.mouseOverClass),this.autoCompleteObj.setValue(f),this._setSubmitOption()):c&&this.moveNextList(a)},changeOnOffText:function(a){a?(this.$onOffTxt.text("자동완성 켜기"),this.hideResultList()):this.$onOffTxt.text("자동완성 끄기")},_attachEvent:function(){this.$resultList.bind("mouseover click",$.proxy(function(a){"mouseover"===a.type?this._onMouseOver(a):"click"===a.type&&this._onClick(a)},this)),this.$onOffTxt&&this.$onOffTxt.bind("click",$.proxy(function(){this._useAutoComplete()},this)),$(document).bind("click",$.proxy(function(a){"html"===a.target.tagName.toLowerCase()&&this.hideResultList()},this))},_applyTemplate:function(a,b){var c,d={};for(c in b)d[c]=b[c],"subject"===c&&(d.subject=this._highlight(b.subject)),b.propertyIsEnumerable(c)&&(a=a.replace(new RegExp("@"+c+"@","g"),d[c]));return a},_highlight:function(a){var b,c=this.autoCompleteObj.querys;return ne.util.forEach(c,function(c){b||(b=a),b=this._makeStrong(b,c)},this),b||a},_makeStrong:function(a,b){if(!b||b.length<1)return a;var c,d,e,f=new RegExp("[.*+?|()\\[\\]{}\\\\]","g"),g=b.replace(/()/g," ").replace(/^\s+|\s+$/g,""),h=g.match(/\S/g),i=h.length,j=[],k="";for(e=0,d=i;d>e;e++)j.push(h[e].replace(/[\S]+/g,"["+h[e].toLowerCase().replace(f,"\\$&")+"|"+h[e].toUpperCase().replace(f,"\\$&")+"] ").replace(/[\s]+/g,"[\\s]*"));return g="("+j.join("")+")",c=new RegExp(g),c.test(a)&&(k=a.replace(c,"<strong>"+RegExp.$1+"</strong>")),k},_getFirst:function(){return this._orderStage(this.flowMap.FIRST)},_getLast:function(){return this._orderStage(this.flowMap.LAST)},_orderStage:function(a){return a=a===this.flowMap.FIRST?"first":"last",this.$resultList&&this.$resultList.children()&&this.$resultList.children().length?this.$resultList.children()[a]():null},_getNext:function(a){return this._orderElement(this.flowMap.NEXT,a)},_getPrev:function(a){return this._orderElement(this.flowMap.PREV,a)},_orderElement:function(a,b){if(!ne.util.isExisty(b))return null;var c,d=$(b),e=a===this.flowMap.NEXT;return d.closest(this.resultSelector)?(c=e?b.next():b.prev(),c.length?c:e?this._getFirst():this._getLast()):void 0},_useAutoComplete:function(){var a=this.autoCompleteObj.isUseAutoComplete();this.changeOnOffText(a),this.autoCompleteObj.setCookieValue(!a)},_showBottomArea:function(){this.$onOffTxt&&this.$onOffTxt.show()},_hideBottomArea:function(){this.$onOffTxt&&this.$onOffTxt.hide()},_setSubmitOption:function(a){this._clearSubmitOption();var b,c=this.options.formElement,d=a?$(a).closest("li"):$(this.selectedElement),e=(this.options.actions,d.attr("data-index")),f=this.options.listConfig[e],g=this.options.actions[f.action];$(c).attr("action",g),b=d.attr("data-params"),this.autoCompleteObj.setParams(b,e),this.autoCompleteObj.fire("change",{index:e,action:g,params:b})},_clearSubmitOption:function(){var a=this.options.formElement,b=$(a).find(".hidden-inputs");b.html("")},_onMouseOver:function(a){var b=$(a.target),c=this.$resultList.find("li"),d=b.closest("li");ne.util.forEachArray(c,function(a){$(a).removeClass(this.mouseOverClass)},this),d&&d.find(".keyword-field").length&&d.addClass(this.mouseOverClass),this.selectedElement=b},_onClick:function(a){var b=$(a.target),c=this.options.formElement,d=b.closest("li"),e=d.find(".keyword-field"),f=e.text();this.autoCompleteObj.setValue(f),c&&f&&(this._setSubmitOption(b),c.submit())}})}();
//# sourceMappingURL=auto-complete.min.map